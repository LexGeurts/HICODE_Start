email_drafting:
  name: email_drafting
  description: Flow for drafting and composing emails
  steps:
    - id: start_drafting
      type: message
      message: I can help you draft an email. Let's gather some information to get started.
      next: collect_recipient
    
    - id: collect_recipient
      type: slot
      slot: email_recipient
      prompt: Who would you like to send this email to? (Email address or name)
      next: collect_subject
    
    - id: collect_subject
      type: slot
      slot: email_subject
      prompt: What's the subject of your email?
      next: collect_purpose
    
    - id: collect_purpose
      type: slot
      slot: email_purpose
      prompt: What is the main purpose of this email? (e.g., follow-up, inquiry, thank you, etc.)
      next: collect_key_points
    
    - id: collect_key_points
      type: slot
      slot: email_key_points
      prompt: What are the key points you want to include in this email?
      next: collect_tone
    
    - id: collect_tone
      type: slot
      slot: email_tone
      prompt: What tone would you like for this email? (e.g., formal, casual, friendly, professional)
      next: generate_draft
    
    - id: generate_draft
      type: calm
      model: openai/gpt-3.5-turbo
      system_prompt: You are an email writing assistant. Craft a well-written email based on the following information:\nRecipient: {email_recipient}\nSubject: {email_subject}\nPurpose: {email_purpose}\nKey Points: {email_key_points}\nTone: {email_tone}\n\nThe email should be professional, concise, and effective. Include a proper greeting and sign-off. Format it like a proper email.
      next: review_draft
    
    - id: review_draft
      type: message
      message: Here's your draft email. Would you like to make any changes?
      next: draft_options
    
    - id: draft_options
      type: router
      conditions:
        - condition: intent == 'edit_draft'
          next: collect_edits
        - condition: intent == 'send_email'
          next: confirm_send
        - condition: intent == 'save_draft'
          next: save_draft
        - condition: intent == 'discard_draft'
          next: confirm_discard
      default: drafting_calm_fallback
    
    - id: collect_edits
      type: slot
      slot: email_edits
      prompt: What changes would you like to make to the draft?
      next: apply_edits
    
    - id: apply_edits
      type: calm
      model: openai/gpt-3.5-turbo
      system_prompt: You are an email editor. The user has a draft email and would like to make the following changes: {email_edits}. Revise the email accordingly while maintaining the original purpose, tone, and key information.
      next: review_draft
    
    - id: confirm_send
      type: confirmation
      message: Are you ready to send this email to {email_recipient}?
      confirmed: send_email
      denied: review_draft
    
    - id: send_email
      type: message
      message: Your email has been sent to {email_recipient}. In a real implementation, this would connect to your email service to send the message.
      next: drafting_complete
    
    - id: save_draft
      type: message
      message: Your draft has been saved. You can access it later to continue editing or send it. In a real implementation, this would save to your email drafts folder.
      next: drafting_complete
    
    - id: confirm_discard
      type: confirmation
      message: Are you sure you want to discard this draft? This action cannot be undone.
      confirmed: discard_draft
      denied: review_draft
    
    - id: discard_draft
      type: message
      message: Your draft has been discarded.
      next: drafting_complete
    
    - id: drafting_calm_fallback
      type: calm
      model: openai/gpt-3.5-turbo
      system_prompt: You are MailoBot, helping with email drafting. The user has said something about their email draft, but it doesn't match our predefined intents. Respond helpfully based on their request related to email drafting.
      next: draft_options
    
    - id: drafting_complete
      type: message
      message: Is there anything else I can help you with regarding email composition?
      next: "END"
